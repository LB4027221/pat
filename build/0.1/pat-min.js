!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Pat=t():e.Pat=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){function i(){return l++}var r=n(1),o=n(4),s=n(18),a=n(8),c=n(9),u=n(2),l=0,h=function(e){this.$el=u.query(e.el),this.$data=e.data||{},this.$rootView=e.rootView?e.rootView:this,this.__template=e.template,this.__node=e.node,this.__watchers={},this.__userWatchers={},this.__filters=e.filters||{},this.__vid=i(),this._init()};h.prototype._init=function(){var e,t,n=this.$el;if(this.__template)for(this.$el.innerHTML="",n=document.createDocumentFragment(),e=document.createElement("div"),e.innerHTML=u.trim(this.__template);t=e.firstChild;)n.appendChild(t);this.$compile(n),this.__template&&this.$el.appendChild(n)},h.prototype.$compile=function(e){r.parseRoot(e,this)},h.prototype.$apply=function(e){return h._isDigesting?void setTimeout(u.bind(arguments.callee,this),0):(h._isDigesting=!0,e&&e.call(this),this.$digest(),void(h._isDigesting=!1))},h.prototype.$digest=function(){this.__userWatchers&&u.each(this.__userWatchers,function(e){e.check()}),this.__watchers&&u.each(this.__watchers,function(e){e.check()})},h.prototype.$destroy=function(e){u.each(this.__watchers,function(e){e.destroy()}),this.__node?this.__node.remove():e?u.remove(this.$el):this.$el.innerHTML="",this.$el=null,this.$data=null,this.$rootView=null,this.__node=null,this.__template=null,this.__watchers=null,this.__userWatchers=null,this.__filters=null},h.config=function(e){u.assign(o,e)},h.prototype.$directive=a.newDirective,h.prototype.$watch=function(e,t){var n;this.__userWatchers[e]?(n=this.__userWatchers[e],n.callbacks.push(t)):(n=new s(this,c.parseExpression(e),t),n.last=n.getValue(),this.__userWatchers[e]=n)},h._isDigesting=!1,e.exports=h},function(e,t,n){function i(e){var t,n,i,r;return i=e.view,t=a.create(e),n=i.__watchers[e.value],n?e.oneTime||n.__directives.push(t):(n=new c(i,e.expression),e.oneTime||(n.__directives.push(t),i.__watchers[e.value]=n)),t.__watcher=n,t.bind(e.args),r=n.getValue(),n.last=r,t.update(r),t}function r(e,n,r){var o,c,u,h;h=e===n.$el?!0:!1,u=0,r=r||[];var p=[],f=[];return s.each(r,function(t){a.isDirective(t)&&(o=l(t),o.view=n,o.el=e,o.block?f.push(o):p.push(o))}),!h&&f.length?(i(f[0]),void(!d.debug&&e&&e.removeAttribute&&s.each(f,function(t){e.removeAttribute(t.name)}))):(p.sort(function(e,t){return e=e.priority||100,t=t.priority||100,e>t?-1:e===t?0:1}),s.each(p,function(e){i(e)}),void(e.hasChildNodes()&&(c=s.toArray(e.childNodes),s.each(c,function(e){t.parse(e,n)}))))}function o(e,t){var n,r,o,a;if(n=h(e.data),1!==n.length||n[0].type!==u.TextTemplateParserTypes.text){a=s.createAnchor("text-place-holder"),s.replace(e,a);for(var c=0,l=n.length;l>c;c++)r=n[c],o=document.createTextNode(r.value),s.before(o,a),r.type===u.TextTemplateParserTypes.binding&&i({name:"",value:r.value,view:t,expression:p(r.value),oneTime:r.oneTime,html:r.html,directive:"textTemplate",el:o});s.remove(a)}}var s=n(2),a=n(8),c=n(18),u=n(9),l=u.parseDirective,h=u.parseText,p=u.parseExpression,d=n(4);t.parseRoot=function(e,t){var n=null;n=t.__node?s.toArray(t.__node.attrs):s.toArray(e.attributes),r(e,t,n)},t.parse=function(e,t){s.isElement(e)&&(3==e.nodeType&&s.trim(e.data)&&o(e,t),1==e.nodeType&&"SCRIPT"!==e.tagName&&r(e,t,s.toArray(e.attributes)))}},function(e,t,n){var i={},r=n(3),o=n(5),s=n(6),a=o.assign;a(i,o),a(i,r),a(i,s),i.Class=n(7),e.exports=i},function(e,t,n){var i=n(4),r=n(5);t.query=function(e){return e?r.isElement(e)?e:r.isString(e)?document.getElementById(e.replace(/^#/,"")):void 0:null},t.createAnchor=function(e,t){var n=i.debug?document.createComment(e):document.createTextNode(t?" ":"");return n},t.before=function(e,t){t.parentNode.insertBefore(e,t)},t.after=function(e,n){n.nextSibling?t.before(e,n.nextSibling):n.parentNode.appendChild(e)},t.remove=function(e){e.parentNode.removeChild(e)},t.prepend=function(e,n){n.firstChild?t.before(e,n.firstChild):n.appendChild(e)},t.replace=function(e,t){var n=e.parentNode;n&&n.replaceChild(t,e)},t.clone=function(e){return e.cloneNode(!0)}},function(e,t){t.prefix="t",t.delimiters=["{{","}}"],t.unsafeDelimiters=["{{{","}}}"],t.debug=!1},function(e,t){function n(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}t.bind=function(e,t){return function(n){var i=arguments.length;return i?i>1?e.apply(t,arguments):e.call(t,n):e.call(t)}},t.htmlspecialchars=function(e){return t.isString(e)?(e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e=e.replace(/'/g,"&#039;")):e},t.trim=function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},t.toArray=function(e){return e?Array.prototype.slice.call(e)||[]:[]},t.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.isObject=function(e){return"function"==typeof e||"object"==typeof e&&null!=e},t.isElement=function(e){return e&&"object"==typeof e&&e.nodeType&&"string"==typeof e.nodeName},t.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},t.each=function(e,n){if(t.isArray(e))for(var i=0,r=e.length;r>i;i++)n(e[i],i);else if(t.isObject(e))for(var o in e)n(e[o],o)},t.assign=function(){if(!(arguments.length<2)){for(var e,i=t.toArray(arguments),r=i.shift();e=i.shift();)n(r,e);return r}},t.hasKey=function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&n==t)return!0;return!1},t.indexOf=function(e,t){if(null===e)return-1;for(var n=0,i=e.length;i>n;n++)if(e[n]===item)return n;return-1}},function(e,t,n){n(4),n(5),void 0!==window.console&&console.log},function(e,t){var n=function(){function e(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}var t=function(){this.initPrototype=!0;var n=new this;this.initPrototype=!1;for(var i,r=Array.prototype.slice.call(arguments)||[];i=r.shift();)e(n,i.prototype||i);var o=function(){!o.initPrototype&&this.init&&this.init.apply(this,arguments)};return o.prototype=n,o.prototype.constructor=o,o.extend=t,o},n=function(){};return n.extend=t,n}();e.exports=n},function(e,t,n){var i=n(2),r=i.Class,o=n(9);DIR_REGX=o.DIR_REGX,INTERPOLATION_REGX=o.INTERPOLATION_REGX;var s={bind:n(11),model:n(12),"if":n(13),unless:n(15),"for":n(16),textTemplate:n(17)},a=function(){};uid=0;var c=r.extend({init:function(e){this.__watcher=null,this.describe=e,this.el=e.el,this.view=e.view,this.uid=uid++},shoudUpdate:function(e,t){return e!==t},bind:a,unbind:a,update:a,destroy:function(){this.unbind(),this.__watcher=null,this.describe=null,this.el=null,this.view=null,this.uid=null}}),u={};i.each(s,function(e,t){u[t]=c.extend(s[t])}),e.exports={__directives:s,publics:u,create:function(e){var t=u[e.directive];return new t(e)},isDirective:function(e){var t,n,r;return t=e.name,(n=e.value)?INTERPOLATION_REGX.test(n)?!0:(r=t.match(DIR_REGX),r&&r[1]&&i.hasKey(s,r[1].split(":")[0])?!0:!1):!1},newDirective:function(e,t){s[e]=t,this.publicDirectives[e]=c.extend(t)}}},function(e,t,n){function i(e){return e.replace(c,"\\$&")}var r=n(4),o=n(2),s=n(10),a=r.prefix,c=(r.delimiters,/[-.*+?^${}()|[\]\/\\]/g),u=new RegExp("^"+a+"-([^=]+)"),l=/:(.*)$/,h=/([^|]+)\|?([\sA-Za-z$_]*)/,p=i(r.delimiters[0]),d=i(r.delimiters[1]),f=i(r.unsafeDelimiters[0]),v=i(r.unsafeDelimiters[1]),m=new RegExp(f+"(.+?)"+v+"|"+p+"(.+?)"+d,"g"),_=new RegExp("^"+f+".*"+v+"$"),g=new RegExp(f+"(.+?)"+v+"|"+p+"(.+?)"+d);t.parseDirective=function(e){var i,r,o,s,a=e.name,c=e.value;if(g.test(c))return r=t.parseText(c),{name:a,value:c,directive:"bind",args:[a],oneTime:!1,html:!1,block:!1,expression:t.token2expression(r),isInterpolationRegx:!0};o=a.match(u)[1],l.test(o)&&(s=o.split(":"),o=s[0],i=s[1]?s[1].split("|"):[]);var h=n(8).__directives[o]||{};return{name:a,value:c,directive:o,args:i||[],oneTime:!1,html:!1,block:h.block,priority:h.priority,expression:t.parseExpression(c)}},t.parseExpression=function(e){var t,n,i,r;return(t=e.match(h))?(n=o.trim(t[1]),i=o.trim(t[2]),r=s.compileExpFns(n),i&&(r="_that.applyFilter("+r+',"'+i+'")'),r):""},TextTemplateParserTypes={text:0,binding:1},t.parseText=function(e){if(e=e.replace(/\n/g,""),!m.test(e))return[{type:TextTemplateParserTypes.text,value:e}];for(var t,n,i,r,s,a,c=[],u=m.lastIndex=0;t=m.exec(e);)n=t.index,n>u&&c.push({type:TextTemplateParserTypes.text,value:e.slice(u,n)}),i=_.test(t[0]),r=i?t[1]:t[2],s=r.charCodeAt(0),a=42===s,r=a?r.slice(1):r,c.push({type:TextTemplateParserTypes.binding,value:o.trim(r),html:i,oneTime:a}),u=n+t[0].length;return u<e.length&&c.push({type:TextTemplateParserTypes.text,value:e.slice(u)}),c},t.token2expression=function(e){var n=[];return o.each(e,function(e){e.type==TextTemplateParserTypes.text?n.push('"'+e.value+'"'):n.push("("+t.parseExpression(e.value)+")")}),n.join("+")},t.INTERPOLATION_REGX=g,t.DIR_REGX=u,t.TextTemplateParserTypes=TextTemplateParserTypes},function(e,t,n){function i(e,t){var n=v.length;return v[n]=t?e.replace(h,"\\n"):e,'"'+n+'"'}function r(e){var t=e.charAt(0),n=e.slice(1);return a.test(n)?e:(n=n.indexOf('"')>-1?n.replace(d,o):n,t+"_scope."+n)}function o(e,t){return v[t]}var s=(n(2),"Math,Date,this,true,false,null,undefined,Infinity,NaN,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,parseInt,parseFloat"),a=new RegExp("^("+s.replace(/,/g,"\\b|")+"\\b)"),c="break,case,class,catch,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,let,return,super,switch,throw,try,var,while,with,yield,enum,await,implements,package,proctected,static,interface,private,public",u=new RegExp("^("+c.replace(/,/g,"\\b|")+"\\b)"),l=/\s/g,h=/\n/g,p=/[\{,]\s*[\w\$_]+\s*:|('[^']*'|"[^"]*")|new |typeof |void /g,d=/"(\d+)"/g,f=/[^\w$\.]([A-Za-z_$][\w$]*(\.[A-Za-z_$][\w$]*|\['.*?'\]|\[".*?"\])*)/g,v=[];t.compileExpFns=function(e,t){u.test(e),v.length=0;var n=e.replace(p,i).replace(l,"");return n=(" "+n).replace(f,r).replace(d,o)}},function(e,t,n){var i=n(2);e.exports={priority:3e3,update:function(e){var t,n;t=this.describe.args||[],n=t[0],n&&(i.isString(e)&&(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;")),this.el.setAttribute(n,e))}}},function(e,t){Util={bindEvent:function(){return"addEventListener"in window?function(e,t,n){return e.addEventListener(t,n,!1)}:function(e,t,n){return e.attachEvent("on"+t,n)}}(),unbindEvent:function(){return"removeEventListener"in window?function(e,t,n){return e.removeEventListener(t,n,!1)}:function(e,t,n){return e.detachEvent("on"+t,n)}}(),getInputValue:function(e){var t,n,i,r;if("checkbox"===e.type)return e.checked;if("select-multiple"===e.type){for(r=[],n=0,i=e.length;i>n;n++)t=e[n],t.selected&&r.push(t.value);return r}return e.value}},e.exports={priority:3e3,bind:function(e){var t=this;Util.bindEvent(t.el,"blur",function(){var e=Util.getInputValue(t.el),n=t.describe.value;e!=t.curValue&&(t.setValue(n,e),t.view.$rootView.$apply())})},setValue:function(e,t){return new Function("$scope","return $scope."+e+'="'+t+'"')(this.view.$data)},update:function(e){this.curValue=e,this.el.value=e},unbind:function(){Util.unbindEvent(this.el,"blur")}}},function(e,t,n){var i=n(2),r=n(14);e.exports={block:!0,priority:3e3,shoudUpdate:function(e,t){return!0},bind:function(e){this.bound=!1,this.placeholder=i.createAnchor("if-statement"),i.replace(this.el,this.placeholder),this.__node=new r(this.el)},update:function(e){e&&0==this.bound&&(this.node=this.__node.clone(),this.childView=new this.view.constructor({el:this.node.el,node:this.node,data:this.view.$data,rootView:this.view.$rootView}),this.node.before(this.placeholder),this.bound=!0),e||1!=this.bound||(this.node.remove(),this.bound=!1),this.childView&&this.childView.$digest()},unbind:function(){this.childView&&this.childView.$destroy()}}},function(e,t,n){function i(e){this.el=e,this.attrs=e.attributes,e.tagName&&"template"===e.tagName.toLowerCase()&&(this.el.content?this.el=this.el.content:this.el=r(this.el)),this.isFrag=e instanceof DocumentFragment,this.isFrag?this.initFragment():this.initNormal()}function r(e){for(var t,n=document.createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}var o=n(2);i.prototype.initNormal=function(){var e=this.el;this.before=function(t){return o.before(e,t)},this.after=function(t){return o.after(e,t)},this.remove=function(t){return o.remove(e,t)},this.clone=function(){return new i(o.clone(e))}},i.prototype.initFragment=function(){var e=this.el;this.start=o.createAnchor("frag-start"),this.end=o.createAnchor("frag-end"),o.prepend(this.start,e),e.appendChild(this.end),this.before=function(t){return o.before(e,t)},this.after=function(t){return o.after(e,t)},this.remove=this._fragmentRemove,this.clone=this._fragmentClone},i.prototype._fragmentRemove=function(){if(this.start&&this.end){for(var e,t=this.start;t!=this.end;)e=t,t=t.nextSibling,o.remove(e);o.remove(this.end)}},i.prototype._fragmentClone=function(){return new i(o.clone(this.el))},e.exports=i},function(e,t,n){var i=n(2),r=n(13);e.exports=i.assign({},r,{update:function(e){return r.update.call(this,!e)}})},function(e,t,n){var i=n(2),r=n(9),o=r.parseExpression,s=n(14),a={MOVE_EXISTING:1,REMOVE_NODE:2,INSERT_MARKUP:3};e.exports={block:!0,priority:3e3,shoudUpdate:function(e,t){var n="lazy"==this.describe.args[0]?!0:!1;return n?e!==t:!0},bind:function(e){var t=this.describe.value.match(/(.*) in (.*)/);if(t){var n=t[1].match(/\((.*),(.*)\)/);n?(this.iterator=n[1].trim(),this.alias=n[2].trim()):this.alias=t[1].trim(),this.__watcher.expression=o(t[2])}this.start=i.createAnchor("for-start"),this.end=i.createAnchor("for-end"),i.replace(this.el,this.end),i.before(this.start,this.end),this.__node=new s(this.el),this.oldViewMap={}},_generateNewChildren:function(e){var t,n,r={},o=this.oldViewMap,s=this;return i.each(e,function(e,a){o[a]&&o[a].$data[s.alias]===e?(r[a]=o[a],i.assign(o[a].$data,s.view.$data),o[a].$digest()):(t={},t[s.alias]=e,i.assign(t,s.view.$data),s.iterator&&(t[s.iterator]=a),n=s.__node.clone(),r[a]=new s.view.constructor({el:n.el,node:n,data:t,rootView:s.view.$rootView}))}),r},_diff:function(){var e,t,n=0,i=0,r=this.oldViewMap,o=this.newViewMap,s=this.diffQueue=[];for(name in o)o.hasOwnProperty(name)&&(e=r&&r[name],t=o[name],e===t?e._mountIndex<i&&s.push({name:name,type:a.MOVE_EXISTING,fromIndex:e._mountIndex,toIndex:n}):(e&&(i=Math.max(e._mountIndex,i),s.push({name:name,type:a.REMOVE_NODE,fromIndex:e._mountIndex,toIndex:null})),s.push({name:name,type:a.INSERT_MARKUP,fromIndex:null,toIndex:n,markup:t.__node})),t._mountIndex=n,n++);for(name in r)!r.hasOwnProperty(name)||o&&o.hasOwnProperty(name)||(e=r&&r[name],s.push({name:name,type:a.REMOVE_NODE,fromIndex:e._mountIndex,toIndex:null}))},_patch:function(){for(var e,t,n={},r=[],o=this.diffQueue,s=0;s<o.length;s++)e=o[s],(e.type===a.MOVE_EXISTING||e.type===a.REMOVE_NODE)&&(t=this.oldViewMap[e.name],n[e.name]=t.__node,r.push(t));i.each(r,function(e){e.$destroy()});for(var c=0;c<o.length;c++)switch(e=o[c],e.type){case a.INSERT_MARKUP:this._insertChildAt(e.markup,e.toIndex);break;case a.MOVE_EXISTING:this._insertChildAt(n[e.name],e.toIndex);break;case a.REMOVE_NODE:}},_insertChildAt:function(e,t){for(var n=this.start,r=this.end,o=-1,s=n,a=!1;s&&s!==r;)if(s=s.nextSibling,i.isElement(s)&&8==s.nodeType&&"frag-end"==s.data&&(a=!1),!a)if(i.isElement(s)&&8==s.nodeType&&"frag-start"==s.data)a=!0;else if(i.isElement(s)&&1==s.nodeType&&(o++,t==o))return void e.after(s);t>o&&e.before(r)},update:function(e){this.newViewMap=this._generateNewChildren(e),this._diff(),this._patch(),this.oldViewMap=this.newViewMap},unbind:function(){i.each(this.newViewMap,function(e){e.$destroy()})}}},function(e,t,n){var i=n(2);e.exports={priority:3e3,bind:function(e){this.placeholder=i.createAnchor("text-statement"),i.replace(this.el,this.placeholder)},update:function(e){var t=this.describe.html;t?this._updateHtml(e):this._updateText(e)},_updateHtml:function(e){this.prev&&this.prev.length>0&&i.each(this.prev,function(e){i.remove(e)});var t,n;for(t=document.createElement("div"),t.innerHTML=e,this.prev=[];n=t.firstChild;)this.prev.push(n),i.before(n,this.placeholder)},_updateText:function(e){this.prev&&i.remove(this.prev),this.prev=document.createTextNode(e),i.before(this.prev,this.placeholder)},unbind:function(){}}},function(e,t,n){function i(e,t,n){this.__directives=[],this.__view=e,this.expression=t,this.callbacks=n?[n]:[],this.scope=e.$data,this.last=null,this.current=null}var r=n(2);i.prototype.applyFilter=function(e,t){if(!t)return e;var n=this.__view.$rootView.__filters[t];return n?n.call(this.__view.$rootView,e,this.scope):e},i.prototype.getValue=function(){if(!this.expression)return"";try{return new Function("_scope","_that","return "+this.expression)(this.scope,this)}catch(e){}},i.prototype.check=function(){var e=this;this.current=this.getValue(),this._check(this.last,this.current),this.last!=this.current&&r.each(this.callbacks,function(t){t(e.last,e.current)}),this.last=this.current},i.prototype._check=function(e,t){r.each(this.__directives,function(n){n.shoudUpdate(e,t)&&n.update&&n.update(t)})},i.prototype.destroy=function(){r.each(this.__directives,function(e){e.destroy&&e.destroy()})},e.exports=i}])});