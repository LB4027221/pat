!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Pat=t():e.Pat=t()}(this,function(){return function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){function r(){return p++}var n=i(1),s=i(4),o=i(8),a=i(19),l=i(9),c=i(10),h=i(20),u=i(2),p=0,d=function(e){this.$el=u.query(e.el),this.$data=e.data||{},this.$rootView=e.rootView?e.rootView:this,this.__template=e.template,this.__node=e.node,this.__watchers={},this.__userWatchers={},this.__filters=e.filters||{},this.__vid=e.vid||r(),this._init()};u.assign(d.prototype,h),d.prototype._init=function(){var e,t,i=this.$el;if(this.__template)for(this.$el.innerHTML="",i=document.createDocumentFragment(),e=document.createElement("div"),e.innerHTML=n.checkTmpl(this.__template);t=e.firstChild;)i.appendChild(t);this.$compile(i),this.__template&&this.$el.appendChild(i)},d.prototype.$compile=function(e){o.parseRoot(e,this)},d.prototype.$apply=function(e){return d._isDigesting?void setTimeout(u.bind(arguments.callee,this),0):(d._isDigesting=!0,e&&e.call(this),this.$digest(),void(d._isDigesting=!1))},d.prototype.$digest=function(){this.__userWatchers&&u.each(this.__userWatchers,function(e){e.check()}),this.__watchers&&u.each(this.__watchers,function(e){e.check()})},d.prototype.$destroy=function(e){u.each(this.__watchers,function(e){e.destroy()}),this.__node?this.__node.remove():e?u.remove(this.$el):this.$el.innerHTML="",this.$el=null,this.$data=null,this.$rootView=null,this.__node=null,this.__template=null,this.__watchers=null,this.__userWatchers=null,this.__filters=null,this._destroyed=!0},d.config=function(e){u.assign(s,e)},d.prototype.$directive=l.newDirective,d.prototype.$watch=function(e,t){var i;this.__userWatchers[e]?(i=this.__userWatchers[e],i.callbacks.push(t)):(i=new a(this,c.parseExpression(e),t),i.last=i.getValue(),this.__userWatchers[e]=i)},d._isDigesting=!1,d.Parser=c,d.Directive=l,d.Compile=o,d.Watcher=a,e.exports=d},function(e,t,i){var r=i(2);_supportTemplate=function(){var e=document.createElement("div");return e.innerHTML="<template>test</template>",!!e.firstChild.innerHTML}(),_supportTemplate||document.createElement("template"),t.checkTmpl=function(e){return _supportTemplate||(e=e.replace(/<template[\s]+/g,'<div _pat_tmpl="true" ').replace(/<\/template>/g,"</div>")),r.trim(e)}},function(e,t,i){var r={},n=i(3),s=i(5),o=i(6),a=s.assign;a(r,s),a(r,n),a(r,o),r.Class=i(7),e.exports=r},function(e,t,i){var r=i(4),n=i(5);t.query=function(e){return e?n.isElement(e)?e:n.isString(e)?document.getElementById(e.replace(/^#/,"")):void 0:null},t.createAnchor=function(e,t){var i=r.debug?document.createComment(e):document.createTextNode(t?" ":"");return i},t.before=function(e,t){t.parentNode.insertBefore(e,t)},t.after=function(e,i){i.nextSibling?t.before(e,i.nextSibling):i.parentNode.appendChild(e)},t.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)},t.prepend=function(e,i){i.firstChild?t.before(e,i.firstChild):i.appendChild(e)},t.replace=function(e,t){var i=e.parentNode;i&&i.replaceChild(t,e)},t.clone=function(e){return e.cloneNode(!0)}},function(e,t){t.prefix="t",t.delimiters=["{{","}}"],t.unsafeDelimiters=["{{{","}}}"],t.debug=!1},function(e,t){function i(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}t.bind=function(e,t){return function(i){var r=arguments.length;return r?r>1?e.apply(t,arguments):e.call(t,i):e.call(t)}},t.htmlspecialchars=function(e){return t.isString(e)?(e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e=e.replace(/'/g,"&#039;")):e},t.trim=function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},t.toArray=function(e){if(!e||!e.length)return[];for(var t=[],i=0,r=e.length;r>i;i++)t.push(e[i]);return t},t.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.isObject=function(e){return"function"==typeof e||"object"==typeof e&&null!=e},t.isElement=function(e){return e&&"object"==typeof e&&e.nodeType&&"string"==typeof e.nodeName},t.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},t.each=function(e,i){if(t.isArray(e))for(var r=0,n=e.length;n>r;r++)i(e[r],r);else if(t.isObject(e))for(var s in e)i(e[s],s)},t.assign=function(){if(!(arguments.length<2)){for(var e,r=t.toArray(arguments),n=r.shift();e=r.shift();)i(n,e);return n}},t.hasKey=function(e,t){for(var i in e)if(e.hasOwnProperty(i)&&i==t)return!0;return!1},t.indexOf=function(e,t){if(null===e)return-1;for(var i=0,r=e.length;r>i;i++)if(e[i]===t)return i;return-1}},function(e,t,i){i(4),i(5),void 0!==window.console&&console.log},function(e,t){var i=function(){function e(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}var t=function(){this.initPrototype=!0;var i=new this;this.initPrototype=!1;for(var r,n=Array.prototype.slice.call(arguments)||[];r=n.shift();)e(i,r.prototype||r);var s=function(){!s.initPrototype&&this.init&&this.init.apply(this,arguments)};return s.prototype=i,s.prototype.constructor=s,s.extend=t,s},i=function(){};return i.extend=t,i}();e.exports=i},function(e,t,i){function r(e){var t,i,r,n;return!d.debug&&e.el&&e.el.removeAttribute&&e.el.removeAttribute(e.name),r=e.view,t=a.create(e),i=r.__watchers[e.value],i?e.oneTime||i.__directives.push(t):(i=new l(r,e.expression),e.oneTime||(i.__directives.push(t),r.__watchers[e.value]=i)),t.__watcher=i,t.bind(e.args),n=i.getValue(),i.last=n,t.update(n),t}function n(e,i,n){var s,l,c,u;u=e===i.$el?!0:!1,c=0,n=n||[];var p=[],d=[];return o.each(n,function(t){a.isDirective(t)&&(s=h(t),s.view=i,s.el=e,s.block?d.push(s):p.push(s))}),!u&&d.length?void r(d[0]):(p.sort(function(e,t){return e=e.priority||100,t=t.priority||100,e>t?-1:e===t?0:1}),o.each(p,function(e){r(e)}),void(e.hasChildNodes()&&(l=o.toArray(e.childNodes),o.each(l,function(e){t.parse(e,i)}))))}function s(e,t){var i,n,s,a;if(i=u(e.data),1!==i.length||i[0].type!==c.TextTemplateParserTypes.text){a=o.createAnchor("text-place-holder"),o.replace(e,a);for(var l=0,h=i.length;h>l;l++)n=i[l],s=document.createTextNode(n.value),o.before(s,a),n.type===c.TextTemplateParserTypes.binding&&r({name:"",value:n.value,view:t,expression:p(n.value),oneTime:n.oneTime,html:n.html,directive:"textTemplate",el:s});o.remove(a)}}var o=i(2),a=i(9),l=i(19),c=i(10),h=c.parseDirective,u=c.parseText,p=c.parseExpression,d=i(4);t.parseRoot=function(e,t){var i=null;i=t.__node?o.toArray(t.__node.attrs):o.toArray(e.attributes),n(e,t,i)},t.parse=function(e,t){o.isElement(e)&&(3==e.nodeType&&o.trim(e.data)&&s(e,t),1==e.nodeType&&"SCRIPT"!==e.tagName&&n(e,t,o.toArray(e.attributes)))}},function(e,t,i){var r=i(2),n=r.Class,s=i(10);DIR_REGX=s.DIR_REGX,INTERPOLATION_REGX=s.INTERPOLATION_REGX;var o={bind:i(12),model:i(13),"if":i(14),unless:i(16),"for":i(17),textTemplate:i(18)},a=function(){};uid=0;var l=n.extend({init:function(e){this.__watcher=null,this.describe=e,this.el=e.el,this.view=e.view,this.uid=uid++},shoudUpdate:function(e,t){return e!==t},bind:a,unbind:a,update:a,destroy:function(){this.unbind(),this.__watcher=null,this.describe=null,this.el=null,this.view=null,this.uid=null}}),c={};r.each(o,function(e,t){c[t]=l.extend(o[t])}),e.exports={__directives:o,publics:c,create:function(e){var t=c[e.directive];return new t(e)},isDirective:function(e){var t,i,n;return t=e.name,(i=e.value)?INTERPOLATION_REGX.test(i)?!0:(n=t.match(DIR_REGX),n&&n[1]&&r.hasKey(o,n[1].split(":")[0])?!0:!1):!1},newDirective:function(e,t){o[e]=t,this.publicDirectives[e]=l.extend(t)}}},function(e,t,i){function r(e){return e.replace(l,"\\$&")}var n=i(4),s=i(2),o=i(11),a=n.prefix,l=(n.delimiters,/[-.*+?^${}()|[\]\/\\]/g),c=new RegExp("^"+a+"-([^=]+)"),h=/:(.*)$/,u=r(n.delimiters[0]),p=r(n.delimiters[1]),d=r(n.unsafeDelimiters[0]),f=r(n.unsafeDelimiters[1]),v=new RegExp(d+"(.+?)"+f+"|"+u+"(.+?)"+p,"g"),_=new RegExp("^"+d+".*"+f+"$"),m=new RegExp(d+"(.+?)"+f+"|"+u+"(.+?)"+p);t.parseDirective=function(e){var r,n,s,o,a=e.name,l=e.value;if(m.test(l))return n=t.parseText(l),{name:a,value:l,directive:"bind",args:[a],oneTime:!1,html:!1,block:!1,expression:t.token2expression(n),isInterpolationRegx:!0};s=a.match(c)[1],h.test(s)&&(o=s.split(":"),s=o[0],r=o[1]?o[1].split("|"):[]);var u=i(9).__directives[s]||{};return{name:a,value:l,directive:s,args:r||[],oneTime:!1,html:!1,block:u.block,priority:u.priority,expression:t.parseExpression(l)}},t.parseExpression=function(e){var t,i,r;return r=e.lastIndexOf("|"),-1!=r&&"|"!==e.charAt(r-1)&&(t=s.trim(e.substr(r+1)),e=e.substr(0,r)),i=s.trim(o.compileExpFns(e)),t&&(i="_that.applyFilter("+i+',"'+t+'")'),i},TextTemplateParserTypes={text:0,binding:1},t.parseText=function(e){if(e=e.replace(/\n/g,""),!v.test(e))return[{type:TextTemplateParserTypes.text,value:e}];for(var t,i,r,n,o,a,l=[],c=v.lastIndex=0;t=v.exec(e);)i=t.index,i>c&&l.push({type:TextTemplateParserTypes.text,value:e.slice(c,i)}),r=_.test(t[0]),n=r?t[1]:t[2],o=n.charCodeAt(0),a=42===o,n=a?n.slice(1):n,l.push({type:TextTemplateParserTypes.binding,value:s.trim(n),html:r,oneTime:a}),c=i+t[0].length;return c<e.length&&l.push({type:TextTemplateParserTypes.text,value:e.slice(c)}),l},t.token2expression=function(e){var i=[];return s.each(e,function(e){e.type==TextTemplateParserTypes.text?i.push('"'+e.value+'"'):i.push("("+t.parseExpression(e.value)+")")}),i.join("+")},t.INTERPOLATION_REGX=m,t.DIR_REGX=c,t.TextTemplateParserTypes=TextTemplateParserTypes},function(e,t,i){function r(e,t){var i=v.length;return v[i]=t?e.replace(u,"\\n"):e,'"'+i+'"'}function n(e){var t=e.charAt(0),i=e.slice(1);return a.test(i)?e:(i=i.indexOf('"')>-1?i.replace(d,s):i,t+"_scope."+i)}function s(e,t){return v[t]}var o=(i(2),"Math,Date,this,true,false,null,undefined,Infinity,NaN,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,parseInt,parseFloat"),a=new RegExp("^("+o.replace(/,/g,"\\b|")+"\\b)"),l="break,case,class,catch,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,let,return,super,switch,throw,try,var,while,with,yield,enum,await,implements,package,proctected,static,interface,private,public",c=new RegExp("^("+l.replace(/,/g,"\\b|")+"\\b)"),h=/\s/g,u=/\n/g,p=/[\{,]\s*[\w\$_]+\s*:|('[^']*'|"[^"]*")|new |typeof |void /g,d=/"(\d+)"/g,f=/[^\w$\.]([A-Za-z_$][\w$]*(\.[A-Za-z_$][\w$]*|\['.*?'\]|\[".*?"\])*)/g,v=[];t.compileExpFns=function(e,t){c.test(e),v.length=0;var i=e.replace(p,r).replace(h,"");return i=(" "+i).replace(f,n).replace(d,s)}},function(e,t,i){var r=i(2);e.exports={priority:3e3,update:function(e){var t,i;return t=this.describe.args||[],(i=t[0])?(r.isString(e)&&(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;")),-1!==r.indexOf(["value","checked","selected"],i)&&i in this.el?void(this.el[i]="value"===i?e||"":e):void(null!=e&&e!==!1?(this.view.$rootView.fire("beforeUpdateAttribute",this.el,this),this.el.setAttribute(i,e),this.view.$rootView.fire("afterUpdateAttribute",this.el,i,e,this)):this.el.removeAttribute(i))):void 0}}},function(e,t){Util={bindEvent:function(){return"addEventListener"in window?function(e,t,i){return e.addEventListener(t,i,!1)}:function(e,t,i){return e.attachEvent("on"+t,i)}}(),unbindEvent:function(){return"removeEventListener"in window?function(e,t,i){return e.removeEventListener(t,i,!1)}:function(e,t,i){return i?e.detachEvent("on"+t,i):e.detachEvent("on"+t)}}(),getInputValue:function(e){var t,i,r,n;if("checkbox"===e.type)return e.checked;if("select-multiple"===e.type){for(n=[],i=0,r=e.length;r>i;i++)t=e[i],t.selected&&n.push(t.value);return n}return e.value}},e.exports={priority:3e3,bind:function(e){var t=this;t.blurFn=function(){var e=Util.getInputValue(t.el),i=t.describe.value;e!=t.curValue&&(t.setValue(i,e),t.view.$rootView.$apply())},Util.bindEvent(t.el,"blur",t.blurFn)},setValue:function(e,t){return new Function("$scope","return $scope."+e+'="'+t+'"')(this.view.$data)},update:function(e){this.curValue=e,this.el.value=e},unbind:function(){Util.unbindEvent(this.el,"blur",self.blurFn)}}},function(e,t,i){var r=i(2),n=i(15);e.exports={block:!0,priority:3e3,shoudUpdate:function(e,t){return!0},bind:function(e){this.bound=!1,this.placeholder=r.createAnchor("if-statement"),r.replace(this.el,this.placeholder),this.__node=new n(this.el)},update:function(e){this.childView&&this.childView.$digest(),e&&0==this.bound&&(this.node=this.__node.clone(),this.childView=new this.view.constructor({el:this.node.el,node:this.node,data:this.view.$data,rootView:this.view.$rootView}),this.view.$rootView.fire("beforeAddBlock",[],this),this.node.before(this.placeholder),this.view.$rootView.fire("afterAddBlock",this.node.allElements(),this),this.bound=!0),e||1!=this.bound||(this.view.$rootView.fire("beforeDeleteBlock",this.node.allElements(),this),this.node.remove(),this.view.$rootView.fire("afterDeleteBlock",[],this),this.bound=!1)},unbind:function(){this.childView&&this.childView.$destroy()}}},function(e,t,i){function r(e){this.el=e,this.attrs=e.attributes,e.tagName&&"template"===e.tagName.toLowerCase()&&(this.el.content?this.el=this.el.content:this.el=n(this.el)),e.getAttribute&&"true"===e.getAttribute("_pat_tmpl")&&(this.el=n(this.el)),this.isFrag=11===this.el.nodeType,this.isFrag?this.initFragment():this.initNormal()}function n(e){for(var t,i=document.createDocumentFragment();t=e.firstChild;)i.appendChild(t);return i}var s=i(2);r.prototype.initNormal=function(){var e=this.el;this.before=function(t){return s.before(e,t)},this.after=function(t){return s.after(e,t)},this.remove=function(t){return s.remove(e,t)},this.allElements=function(){return[this.el]},this.clone=function(){return new r(s.clone(e))}},r.prototype.initFragment=function(){var e=this.el;this.start=s.createAnchor("frag-start",!0),this.end=s.createAnchor("frag-end",!0),s.prepend(this.start,e),e.appendChild(this.end),this.before=function(t){return s.before(e,t)},this.after=function(t){return s.after(e,t)},this.remove=this._fragmentRemove,this.clone=this._fragmentClone,this.allElements=function(){if(this.__allElements)return this.__allElements;var e=[];if(this.start&&this.end){for(var t=this.start;t&&t!=this.end;)t=t.nextSibling,1==t.nodeType&&e.push(t);return this.__allElements=e,e}}},r.prototype._fragmentRemove=function(){if(this.start&&this.end){for(var e,t=this.start;t&&t!=this.end;)e=t,t=t.nextSibling,s.remove(e);s.remove(this.end)}},r.prototype._fragmentClone=function(){return new r(s.clone(this.el))},e.exports=r},function(e,t,i){var r=i(2),n=i(14);e.exports=r.assign({},n,{update:function(e){return n.update.call(this,!e)}})},function(e,t,i){var r=i(2),n=i(10),s=n.parseExpression,o=i(15),a={MOVE_EXISTING:1,REMOVE_NODE:2,INSERT_MARKUP:3},l=0;e.exports={block:!0,priority:3e3,shoudUpdate:function(e,t){var i="lazy"==this.describe.args[0]?!0:!1;return i?e!==t:!0},bind:function(e){var t=this.describe.value.match(/(.*) in (.*)/);if(t){var i=t[1].match(/\((.*),(.*)\)/);i?(this.iterator=r.trim(i[1]),this.alias=r.trim(i[2])):this.alias=r.trim(t[1]),this.__watcher.expression=s(t[2])}this.start=r.createAnchor("for-start"),this.end=r.createAnchor("for-end"),r.replace(this.el,this.end),r.before(this.start,this.end),this.__node=new o(this.el),this.__isFrag=this.__node.isFrag,this.oldViewMap={},this.oldViewLists=[]},_generateKey:function(){return"key"+l++},_generateNewChildren:function(e){var t,i,n,s=this.newViewMap={},o=this.newViewLists=[],a=this.oldViewMap,l=this,c="__pat_key__"+l.uid;r.each(e,function(e,h){n=e[c],n&&a[n]&&a[n].$data[l.alias]===e?(s[n]=a[n],r.assign(a[n].$data,l.view.$data),l.iterator&&(a[n].$data[l.iterator]=h),a[n].$digest()):(t={},t[l.alias]=e,r.assign(t,l.view.$data),l.iterator&&(t[l.iterator]=h),i=l.__node.clone(),n=l._generateKey(),e[c]=n,s[n]=new l.view.constructor({el:i.el,node:i,data:t,vid:n,rootView:l.view.$rootView})),o.push(s[n])})},_diff:function(){for(var e,t,i,r=0,n=0,s=this.oldViewMap,o=this.newViewMap,l=this.newViewLists,c=this.diffQueue=[],h=0,u=l.length;u>h;h++)i=l[h].__vid,e=s&&s[i],t=l[h],e===t?e._mountIndex<n&&c.push({name:i,type:a.MOVE_EXISTING,fromIndex:e._mountIndex,toIndex:r}):(e&&(n=Math.max(e._mountIndex,n),c.push({name:i,type:a.REMOVE_NODE,fromIndex:e._mountIndex,toIndex:null})),c.push({name:i,type:a.INSERT_MARKUP,fromIndex:null,toIndex:r,markup:t.__node})),t._mountIndex=r,r++;for(i in s)!s.hasOwnProperty(i)||o&&o.hasOwnProperty(i)||(e=s&&s[i],c.push({name:i,type:a.REMOVE_NODE,fromIndex:e._mountIndex,toIndex:null}))},_patch:function(){for(var e,t,i=this,n={},s=[],o=this.diffQueue,l=0;l<o.length;l++)e=o[l],(e.type===a.MOVE_EXISTING||e.type===a.REMOVE_NODE)&&(t=this.oldViewMap[e.name],n[e.name]=t.__node,s.push(t));r.each(s,function(e){i.view.$rootView.fire("beforeDeleteBlock",e.__node.allElements(),i),e.$destroy(),i.view.$rootView.fire("afterDeleteBlock",[],i)});for(var c=this._generateOldReuseLists(),h=this.__isFrag?this._insertFragAt:this._insertChildAt,u=0;u<o.length;u++)switch(e=o[u],e.type){case a.INSERT_MARKUP:h.call(this,e.markup,e.toIndex,c);break;case a.MOVE_EXISTING:h.call(this,n[e.name],e.toIndex,c);break;case a.REMOVE_NODE:}},_generateOldReuseLists:function(){var e=this.oldViewLists,t=(this.oldViewMap,[]);return r.each(e,function(e){e&&e._destroyed!==!0&&t.push(e.__node)}),t},_insertChildAt:function(e,t,i){for(var r=this.start,n=this.end,s=this,o=-1,a=r,l=i.shift();a&&a!==n;)if(a=a.nextSibling,l&&a===l.el&&(o++,l=i.shift()),t==o){s.view.$rootView.fire("beforeAddBlock",[],s),e.before(a),s.view.$rootView.fire("afterAddBlock",e.allElements(),s);break}t>o&&(s.view.$rootView.fire("beforeAddBlock",[],s),e.before(n),s.view.$rootView.fire("afterAddBlock",e.allElements(),s))},_insertFragAt:function(e,t,i){for(var r=this.start,n=this.end,s=this,o=-1,a=r,l=i.shift(),c=!1;a&&a!==n;)if(a=a.nextSibling,l&&a===l.end&&(c=!1),!c&&(l&&a===l.start&&(o++,l=i.shift()),t==o)){s.view.$rootView.fire("beforeAddBlock",[],s),e.before(a),s.view.$rootView.fire("afterAddBlock",e.allElements(),s);break}t>o&&(s.view.$rootView.fire("beforeAddBlock",[],s),e.before(n),s.view.$rootView.fire("afterAddBlock",e.allElements(),s))},update:function(e){this._generateNewChildren(e),this._diff(),this._patch(),this.oldViewMap=this.newViewMap,this.oldViewLists=this.newViewLists},unbind:function(){r.each(this.oldViewMap,function(e){e.$destroy()}),this.oldViewMap=null,this.oldViewLists=null}}},function(e,t,i){var r=i(2);e.exports={priority:3e3,bind:function(e){this.placeholder=r.createAnchor("text-statement"),r.replace(this.el,this.placeholder)},update:function(e){var t=this.describe.html;t?this._updateHtml(e):this._updateText(e)},_updateHtml:function(e){this.prev&&this.prev.length>0&&(this.view.$rootView.fire("beforeDeleteBlock",this.prev,this),r.each(this.prev,function(e){r.remove(e)}),this.view.$rootView.fire("afterDeleteBlock",[],this));var t,i;for(t=document.createElement("div"),t.innerHTML=e,this.prev=[],this.view.$rootView.fire("beforeAddBlock",[],this);i=t.firstChild;)this.prev.push(i),r.before(i,this.placeholder);this.view.$rootView.fire("afterAddBlock",this.prev,this)},_updateText:function(e){this.prev&&(this.view.$rootView.fire("beforeDeleteBlock",[this.prev],this),r.remove(this.prev),this.view.$rootView.fire("afterDeleteBlock",[],this)),(void 0===e||null===e)&&(e=""),this.prev=document.createTextNode(e),this.view.$rootView.fire("beforeAddBlock",[],this),r.before(this.prev,this.placeholder),this.view.$rootView.fire("afterAddBlock",[this.prev],this)},unbind:function(){}}},function(e,t,i){function r(e,t,i){this.__directives=[],this.__view=e,this.expression=t,this.callbacks=i?[i]:[],this.scope=e.$data,this.last=null,this.current=null}var n=i(2);r.prototype.applyFilter=function(e,t){if(!t)return e;var i=this.__view.$rootView.__filters[t];return i?i.call(this.__view.$rootView,e,this.scope):e},r.prototype.getValue=function(){if(!this.expression)return"";try{return new Function("_scope","_that","return "+this.expression)(this.scope,this)}catch(e){}},r.prototype.check=function(){var e=this;this.current=this.getValue(),this._check(this.last,this.current),this.last!=this.current&&n.each(this.callbacks,function(t){t(e.last,e.current)}),this.last=this.current},r.prototype._check=function(e,t){var i=this;n.each(this.__directives,function(r){r.shoudUpdate(e,t)&&(i.__view.$rootView.fire("beforeDirectiveUpdate",r,e,t),r.update&&r.update(t),i.__view.$rootView.fire("afterDirectiveUpdate",r,e,t))})},r.prototype.destroy=function(){n.each(this.__directives,function(e){e.destroy&&e.destroy()})},e.exports=r},function(e,t,i){var r=i(2);e.exports={on:function(e,t){return this.__events||(this.__events={}),this.__events[e]||(this.__events[e]=[]),-1===r.indexOf(this.__events,t)&&"function"==typeof t&&this.__events[e].push(t),this},fire:function(e){if(this.__events&&this.__events[e]){var t=Array.prototype.slice.call(arguments,1)||[],i=this.__events[e],r=0,n=i.length;for(r;n>r;r++)i[r].apply(this,t);return this}},off:function(e,t){if(e||t||(this.__events={}),e&&!t&&delete this.__events[e],e&&t)var i=this.__events[e],n=r.indexOf(i,t)(n>-1)&&i.splice(n,1);return this}}}])});